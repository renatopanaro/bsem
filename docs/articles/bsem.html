<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>bsem • bsem</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="bsem">
<meta property="og:description" content="bsem">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bsem</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bsem.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/exploring-bsem-class.html">Exploring bsem class</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rvpanaro/bsem/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="bsem_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>bsem</h1>
            <h3 class="subtitle">An R package for Bayesian structural equation modeling</h3>
                        <h4 class="author">Renato V. Panaro</h4>
            <address class="author_afil">
      Departamento de Estatística, IME, Universidade de São Paulo<br><a class="author_email" href="mailto:#"></a><a href="mailto:renatovp@ime.usp.br" class="email">renatovp@ime.usp.br</a>
      </address>
                              <h4 class="author">Vinicius D. Mayrink</h4>
            <address class="author_afil">
      Departamento de Estatística, ICEx, Universidade de Federal de Minas Gerais<br><a class="author_email" href="mailto:#"></a><a href="mailto:vdinizm@gmail.com" class="email">vdinizm@gmail.com</a>
      </address>
                              <h4 class="author">Marcelo A. Costa</h4>
            <address class="author_afil">
      Departamento de Engenharia de Produção, Escola de Engenharia, Universidade de Federal de Minas Gerais<br><a class="author_email" href="mailto:#"></a><a href="mailto:macosta.est@gmail.com" class="email">macosta.est@gmail.com</a>
      </address>
                  
            <h4 class="date">2020-08-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rvpanaro/bsem/blob/master/vignettes/bsem.Rmd"><code>vignettes/bsem.Rmd</code></a></small>
      <div class="hidden name"><code>bsem.Rmd</code></div>

    </div>

    
    
<style>
body {
text-align: justify
</style>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette introduces the <code>bsem</code> package routines. This package was designed to allow particular cases of structural equation models (SEMs) in <code>R</code>. Examples include confirmatory factor analysis (CFA) and confirmatory SEM. The flexible full SEM model (outer model + inner model), implemented here, enables the evaluation of user-defined constructs (latent variables) along with the analysis of established relationships among the latent scores (factors depending on other factors) and/or exogenous variables (variables depending on factors).</p>
<p>Factor analysis (FA) is a powerful and flexible tool to investigate the multivariate dependence in a data set. The main aim is to reduce dimension, i.e., summarize the information expressed in multiple observed variables. The summarization process involves the construction of a few unobserved latent factors representing the existing subjacent patterns in the data. The usual FA can be divided into two types: exploratory (EFA) and confirmatory (CFA). The EFA does not impose any restriction on the relationship between latent factors and observed variables (the model is free to establish such associations). The CFA accounts for the technical information regarding the connections between observed and latent variables; examples of applications involving the CFA can be found in <a href="https://www.guilford.com/books/Confirmatory-Factor-Analysis-for-Applied-Research/Timothy-Brown/9781462515363">Brown</a> (2015). In this case, the researcher must impose that a factor is exclusively explained by a group of observed variables. The CFA is widely used in the context of SEM, see the references <a href="https://link.springer.com/article/10.1007/BF02296651">Lee and Song</a> (2003), <a href="https://www.routledge.com/Generalized-Latent-Variable-Modeling-Multilevel-Longitudinal-and-Structural/Skrondal-Rabe-Hesketh/p/book/9781584880004">Skrondal and Rabe-Hesketh</a> (2004), <a href="https://www.elsevier.com/books/handbook-of-latent-variable-and-related-models/lee/978-0-444-52044-9">Palomo, Dunson, and Bollen</a> (2007), <a href="https://www.guilford.com/books/Handbook-of-Structural-Equation-Modeling/Rick-Hoyle/9781462516797">Hoyle</a> (2014) and <a href="https://www.routledge.com/Multiple-Regression-and-Beyond-An-Introduction-to-Multiple-Regression/Keith/p/book/9781138061446">Keith</a>(2019). Besides the EFA and CFA, it is possible to work with an intermediate case combining these two types. This option can be seen as a semi-confirmatory FA and an example is described in <a href="https://projecteuclid.org/DPubS?service=UI&amp;version=1.0&amp;verb=Display&amp;handle=euclid.aoas/1372338468">Mayrink and Lucas</a> (2013) and <a href="https://projecteuclid.org/euclid.bjps/1414674773">Mayrink and Lucas</a> (2015).</p>
<p>The structure of an SEM has two parts, one involving a CFA and another with multiple regression equations. For an overview of SEMs, it is recommended to read the work <a href="https://www.jstor.org/stable/27590684?seq=1">Sanchez et al.</a> (2005), which is focused on applications in epidemiology. The studies <a href="https://psycnet.apa.org/doiLanding?doi=10.1037%2F0033-2909.103.3.411">Anderson and Gerbing</a> (1988) and <a href="https://doi.org/10.1146/annurev.psych.51.1.201">MacCallum and Austin</a> (2000) provide an overview of the use of SEM in psychology. Examples using SEMs in the context of Bayesian inference are discussed in <a href="https://www.elsevier.com/books/handbook-of-latent-variable-and-related-models/lee/978-0-444-52044-9">Palomo, Dunson, and Bollen</a> (2007). A clear advantage of using the Bayesian approach is the fact that asymptotic assumptions, required by frequentist maximum likelihood methods, may not be valid depending on the sample size. The reference <a href="https://link.springer.com/article/10.1007/BF02296651">Lee and Song</a> (2003) highlights the good performance of the Bayesian SEM in a comparison with the frequentist version.</p>
<p>Consider:</p>
<ul>
<li><p>the outer model (blocks) as: <span class="math display">\[\boldsymbol{X_{p\times n}} = \boldsymbol{\alpha}_{p\times k}\boldsymbol{\lambda}_{k\times n} +\boldsymbol{\varepsilon}_{p\times n}\]</span> where <span class="math inline">\(\boldsymbol{X}\)</span> is the data matrix with variables in the rows and sample elements in the columns, <span class="math inline">\(\boldsymbol{\alpha}_{p\times j}\)</span> is the column vector of loadings for the <span class="math inline">\(j^{th}\)</span> latent variable and <span class="math inline">\(\boldsymbol{\lambda}_{j\times n}\)</span> is the row vector of scores for the <span class="math inline">\(j^{th}\)</span> unobserved variable,<span class="math inline">\(~j =1,\dots,k\)</span>. Normality is assumed for the errors as <span class="math inline">\(\boldsymbol{\varepsilon}_{ij}\sim N(0, \sigma_{i}^2)\)</span> for <span class="math inline">\(i = 1,\dots, p\)</span>.</p></li>
<li>
<p>the inner model as:</p>
<ul>
<li><p>paths: <span class="math display">\[\boldsymbol{\lambda}_{j\times n} = \boldsymbol{\beta}^{\top} {\lambda^{(-j)}}  + \nu~\]</span> where <span class="math inline">\(\boldsymbol{\beta}\)</span> is a column vector of constant coefficients, <span class="math inline">\({\lambda^{(-j)}}_{ (k-1)\times n}\)</span> represents a subset of the matrix of scores, i.e. at least excluding the <span class="math inline">\(j^{th}\)</span> row scores. The errors are independent and assume <span class="math inline">\(\nu_j \sim N(0,1)\)</span>.</p></li>
<li><p>exogenous: <span class="math display">\[\boldsymbol{Y}_{l\times n} = \boldsymbol{\gamma_0} + \boldsymbol{\gamma}^{\top} {\lambda}  + \xi~\]</span> where <span class="math inline">\(\boldsymbol{\gamma}\)</span> is a column vector of constant coefficients and <span class="math inline">\(\boldsymbol{\gamma_0}\)</span> is the intercept. <span class="math inline">\(\lambda_{k \times n}\)</span> is the matrix of scores. The errors are independent and assume <span class="math inline">\(\xi_l\sim N(0,\tau_l^2)\)</span>.</p></li>
</ul>
</li>
</ul>
<p>The guidelines in this document were divided into 4 sections: <a href="#installation">installation</a>, <a href="#description">description</a>, <a href="#usage">usage</a>, and <a href="#remarks">remarks</a>.</p>
</div>
<div id="installation" class="section level1">
<h1 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h1>
<p>The <code>bsem</code> package imports <code>Stan</code> software specific routines to support internal calculations. The <a href="https://mc-stan.org/users/interfaces/rstan"><code>rstan</code></a> package interface enables the use of the NUTS algorithm ( <a href="http://www.stat.columbia.edu/~gelman/research/published/nuts.pdf">Hoffman and Gelman, 2014</a>) to explore the posterior distribution efficiently in R. The development version of <code>bsem</code> can be found in <a href="https://github.com/rvpanaro/bsem">github.com/rvpanaro/bsem</a>.</p>
<p>For github version:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"devtools"</span>)
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"rvpanaro/bsem"</span>, <span class="kw">dependencies</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>For CRAN version:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"bsem"</span>, <span class="kw">dependencies</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>During the installation, dependencies might be required, such as <code>magrittr</code>, <code>lattice</code>, <code>viridis</code>, <code>coda</code>, <code>DiagrammeR</code>, <code>visNetwork</code> and, obviously, <code>rstan</code> and its dependencies. Other packages are also suggested such as <code>ggplot2</code>, <code>bayesplot</code> and <code>tidybayes</code>. The default arguments used to build the <code><a href="../reference/sem.html">bsem::sem</a></code> routine will be introduced in the next sections, this is the main function of the package, as it allows the Bayesian analysis for SEM and its particular cases.</p>
</div>
<div id="description" class="section level1">
<h1 class="hasAnchor">
<a href="#description" class="anchor"></a>Description</h1>
<p>The data and additional commands are passed through the <code><a href="../reference/sem.html">bsem::sem</a></code> function:</p>
<ul>
<li>
<code>data</code>: a mandatory ‘matrix’ object where the columns are variables and the rows are observations</li>
<li>
<code>blocks</code>: a mandatory named list of <code>colnames</code> (or integers in 1:ncol(data)) indicating the manifest variables corresponding to each block; generic names are assumed for latent variables internally if not defined</li>
<li>
<code>paths</code>: list referring to the inner model paths; a list of characters or integers referring to the score’s relationship; the jth first latent variable is explained if names(paths) is NULL</li>
<li>
<code>exogenous</code>:<br>
list referring to the inner model exogenous; a list of characters or integers referring to the relationship between exogenous and latent variables; the lth first columns are explained if names(exogenous) is NULL</li>
<li>
<code>signals</code>: list referring to the signals of the factor loadings initial values; must be true: (length(signals) == length(blocks)) &amp;&amp; (lengths(signals) == lengths(blocks))</li>
<li>
<code>row_names</code>: optional identifier for the observations (observation = row);</li>
<li>
<code>prior_specs</code>: prior settings for the Bayesian approach; only ‘normal’ and ‘cauchy’ for gamma0, gamma and beta; ‘gamma’, ‘lognormal’ and ‘inv_gamma’ for sigma2 and tau2 are available, those prior specifications are ignored if not needed (FA or SEM)</li>
<li>
<code>cores</code>: number of core threads to be used</li>
<li>
<code>pars</code>: allows parameters to omitted in the outcome; options are any subset of default c(“alpha”, “lambda”, “sigma2”)</li>
<li>
<code>iter</code>: number of iterations</li>
<li>
<code>chains</code>: number of chains</li>
<li>
<code>scaled</code>: logical; indicates whether to center and scale the data; default FALSE</li>
<li>
<code>...</code>: further arguments passed to Stan such as warmup, adapt_delta, and others, see rstan::sampling.</li>
</ul>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/sem.html">sem</a></span>(
  <span class="no">data</span>,
  <span class="no">blocks</span>,
  <span class="no">paths</span>,
  <span class="no">exogenous</span>,
  <span class="no">signals</span>,
  <span class="kw">row_names</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">data</span>),
  <span class="kw">prior_specs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">beta</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"normal(0,1)"</span>),
    <span class="kw">sigma2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"inv_gamma(2.1, 1.1)"</span>),
    <span class="kw">gamma0</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"normal(0,1)"</span>), <span class="kw">gamma</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"normal(0,1)"</span>),
    <span class="kw">tau2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"inv_gamma(2.1, 1.1)"</span>)
  ),
  <span class="kw">cores</span> <span class="kw">=</span> <span class="kw pkg">parallel</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span>(),
  <span class="kw">pars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"alpha"</span>, <span class="st">"lambda"</span>, <span class="st">"sigma2"</span>),
  <span class="kw">iter</span> <span class="kw">=</span> <span class="fl">2000</span>,
  <span class="kw">chains</span> <span class="kw">=</span> <span class="fl">4</span>,
  <span class="kw">scaled</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="no">...</span>
)</pre></body></html></div>
<p>The above function automatically selects the appropriate routine according to the specified arguments, examples are given in the following vignette. <a href="exploring-bsem-class.html">Exploring bsem class</a> has details on how to simulate datasets considering the structures described. One can reproduce the examples below by copying and pasting the following code to the <code>R</code> console. For these examples, simulated artificial data sets were created so that we can verify that the estimates are close enough to the true value of the parameters used to generate the data.</p>
</div>
<div id="usage" class="section level1">
<h1 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h1>
<p>In this section, we will use simulated data from the full model described in the introduction. In many applications, with the help of technical knowledge, it is possible to establish relationships between all variables in the data set and the latent variables (constructs) studied, this characterizes the confirmatory factor analysis (CFA). Besides that, we can also verify linear relationships between observed, latent, and/or exogenous variables. The basic structure suitable to allow bsem usage is as follows:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">dt</span> <span class="kw">&lt;-</span> <span class="kw pkg">bsem</span><span class="kw ns">::</span><span class="fu"><a href="../reference/simdata.html">simdata</a></span>()
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">dt</span>)</pre></body></html></div>
<pre><code>## [1] "data"      "real"      "blocks"    "signals"   "paths"     "exogenous"</code></pre>
<p>In this example, <code>data</code> is a matrix, <code>real</code> is the set of parameters used to generate the simulated data as described in the intro. <code>blocks</code>, <code>signals</code>, <code>paths</code> and <code>exogenous</code> are lists that define the modeling. It is worth mentioning that all lists are named, either by the user or internally. The <code>paths</code> should be named after <code>block</code> names and the <code>exogenous</code> list after the colnames of the data, i.e. variable names. The list scheme is useful to describe one relationship between variables and a factor at a time. For example:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">dt</span>$<span class="no">exogenous</span></pre></body></html></div>
<pre><code>## $Y1
## [1] 1 2</code></pre>
<p>The latent scores <code>F1</code> and <code>F2</code> are the explanatory variables of the exogenous variable <code>Y1</code>. The <code>paths</code> list also represents a linear regression model, while the <code>blocks</code> list determines the CFA part of the model.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">dt</span>$<span class="no">blocks</span></pre></body></html></div>
<pre><code>## $F1
## [1] 1 2 3
## 
## $F2
## [1] 4 5 6 7
## 
## $F3
## [1]  8  9 10
## 
## $F4
## [1] 11 12 13 14 15 16
## 
## $F5
## [1] 17 18 19 20 21</code></pre>
<p>In this example, the first 3 variables in the dataset manifest the latent variable <code>F1</code>, we will refer to it as the first block.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">dt</span>$<span class="no">data</span>)</pre></body></html></div>
<pre><code>##  [1] "Y1"  "X1"  "X2"  "X3"  "X4"  "X5"  "X6"  "X7"  "X8"  "X9"  "X10" "X11"
## [13] "X12" "X13" "X14" "X15" "X16" "X17" "X18" "X19" "X20" "X21"</code></pre>
<p>Note that the manifest variables can not include exogenous variables in <code>dt$data</code>. Thus, the first block is expressed by <code>X1</code>, <code>X2</code>, and <code>X3</code>, as the variable <code>Y</code> is internally considered just for the inner part.</p>
<p><code>data</code>, <code>blocks</code>, <code>paths</code> and <code>exogenous</code> arguments should specify the SEM model with exogenous variables:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">fit</span> <span class="kw">&lt;-</span> <span class="kw pkg">bsem</span><span class="kw ns">::</span><span class="fu"><a href="../reference/sem.html">sem</a></span>(
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">dt</span>$<span class="no">data</span>,
  <span class="kw">blocks</span> <span class="kw">=</span> <span class="no">dt</span>$<span class="no">blocks</span>,
  <span class="kw">paths</span> <span class="kw">=</span> <span class="no">dt</span>$<span class="no">paths</span>,
  <span class="kw">exogenous</span> <span class="kw">=</span> <span class="no">dt</span>$<span class="no">exogenous</span>,
  <span class="kw">signals</span> <span class="kw">=</span> <span class="no">dt</span>$<span class="no">signals</span>
  )</pre></body></html></div>
<p>After fitting the model we can to obtain a <code>visNetwork</code> graph using:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">fit</span>)</pre></body></html></div>
<p><img src="plot-bsem.png" width="700"></p>
<p>The ellipsoidal nodes represent the latent variables, the boxes represent the manifest variables, the dashed lines represent the linear relations among latent scores or between latent scores, and exogenous variables and the solid lines represent the relationship between the manifest and latent variables. Finally, the recursive solid lines refer to the error variance estimate of each manifest or exogenous variable.</p>
<p>Also, the scores and loadings used to generate the data can be visually compared to the estimates obtained using the <code>lattice</code> library routines imported in <code>arrayplot</code> function:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="kw pkg">gridExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(
  <span class="kw pkg">bsem</span><span class="kw ns">::</span><span class="fu"><a href="../reference/arrayplot.html">arrayplot</a></span>(<span class="no">fit</span>$<span class="no">mean_lambda</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"estimates"</span>),
  <span class="kw pkg">bsem</span><span class="kw ns">::</span><span class="fu"><a href="../reference/arrayplot.html">arrayplot</a></span>(<span class="no">dt</span>$<span class="no">real</span>$<span class="no">lambda</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"lambda (scores)"</span>)
)

<span class="kw pkg">gridExtra</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(
  <span class="kw pkg">bsem</span><span class="kw ns">::</span><span class="fu"><a href="../reference/arrayplot.html">arrayplot</a></span>(<span class="no">fit</span>$<span class="no">mean_alpha</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"estimates"</span>),
  <span class="kw pkg">bsem</span><span class="kw ns">::</span><span class="fu"><a href="../reference/arrayplot.html">arrayplot</a></span>(<span class="no">dt</span>$<span class="no">real</span>$<span class="no">alpha</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"alpha (loadings)"</span>),
  <span class="kw">layout_matrix</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>), <span class="kw">ncol</span>  <span class="kw">=</span> <span class="fl">2</span>)
)</pre></body></html></div>
<p><img src="alpha-bsem.png" width="700"></p>
<p><img src="lambda-bsem.png" width="700"></p>
<p>For this vignette we fitted the model using just one chain, it is recommended up to 4 chains with 2000 iterations and 1000 warmup samples (standard) to reach the equilibrium distribution. Even so, we found that the estimates follow the pattern of the true values of the parameters:</p>
<table class="table">
<thead><tr class="header">
<th>Parameter</th>
<th>Estimate</th>
<th>True</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\beta_1\)</span></td>
<td>0.8727</td>
<td>1</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\beta_2\)</span></td>
<td>-0.7390</td>
<td>-0.5</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\beta_3\)</span></td>
<td>-1.0935</td>
<td>-1</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\beta_4\)</span></td>
<td>0.7629</td>
<td>0.5</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\gamma_0\)</span></td>
<td>1.5024</td>
<td>1.5</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\gamma_1\)</span></td>
<td>0.6172</td>
<td>0.5</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\gamma_2\)</span></td>
<td>-1.0714</td>
<td>-1</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\tau_1\)</span></td>
<td>0.5109</td>
<td>0.49</td>
</tr>
</tbody>
</table>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">bsem::summary</a></code> routine prints descriptive statistics to the R console:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">fit</span>)</pre></body></html></div>
<pre><code>---
bsem model:  semEX 
latent variables (outer model):  5 
regressions (inner model):  2 


 outer model loadings (alpha):

 F1 
      mean     50%     sd   HPD.l   HPD.u n_eff  Rhat
X1  1.8197  1.7972 0.2605  1.3350  2.3161   316 1.012
X2 -0.3477 -0.3406 0.1566 -0.6556 -0.0429  2525 1.000
X3  2.1240  2.0980 0.3056  1.5541  2.7079   308 1.012

 F2 
      mean     50%     sd   HPD.l   HPD.u n_eff  Rhat
X4 -0.6499 -0.6326 0.1816 -0.9907 -0.2947  1098 1.003
X5  1.7495  1.7178 0.2580  1.2934  2.2814   368 1.009
X6 -1.4583 -1.4304 0.2916 -2.0355 -0.8950   666 1.005
X7  1.0505  1.0325 0.1617  0.7577  1.3752   409 1.009

 F3 
      mean    50%     sd   HPD.l  HPD.u n_eff  Rhat
X8   1.223  1.206 0.3445  0.5423  1.890  1478 1.000
X9  -1.893 -1.860 0.2805 -2.4365 -1.385   436 1.002
X10 -1.463 -1.438 0.2210 -1.9096 -1.073   438 1.002

 F4 
       mean     50%     sd  HPD.l   HPD.u n_eff  Rhat
X11 -0.9687 -0.9521 0.1607 -1.292 -0.6674   517 1.009
X12  0.2422  0.2433 0.2520 -0.240  0.7702  5447 1.002
X13 -1.9023 -1.8692 0.2806 -2.470 -1.3909   409 1.012
X14  1.0326  1.0120 0.3873  0.267  1.7872  2056 1.002
X15 -1.1645 -1.1491 0.1774 -1.539 -0.8550   438 1.010
X16 -1.4857 -1.4598 0.2156 -1.923 -1.0949   402 1.012

 F5 
       mean     50%     sd   HPD.l   HPD.u n_eff  Rhat
X17 -1.9887 -1.9565 0.2819 -2.5169 -1.4736   381 1.004
X18  1.4600  1.4349 0.3714  0.7853  2.2319  1082 1.002
X19 -1.9699 -1.9393 0.2792 -2.4921 -1.4650   380 1.005
X20  0.3432  0.3361 0.2211 -0.0969  0.7885  4658 1.001
X21 -1.7444 -1.7163 0.2480 -2.2093 -1.2973   394 1.006

---

 idiosyncratic error variances (sigma2):
             mean    50%     sd  HPD.l  HPD.u n_eff   Rhat
sigma2[1]  0.1293 0.1230 0.0417 0.0641 0.2079  2755 1.0007
sigma2[2]  0.9872 0.9453 0.2562 0.5519 1.5001  5222 1.0010
sigma2[3]  0.1435 0.1354 0.0453 0.0704 0.2325  2488 1.0008
sigma2[4]  1.3332 1.2802 0.3480 0.7662 2.0595  5403 1.0010
sigma2[5]  0.2012 0.1869 0.0755 0.0877 0.3558  2227 1.0008
sigma2[6]  2.4066 2.3076 0.6574 1.3179 3.7626  5324 1.0025
sigma2[7]  0.2197 0.2091 0.0690 0.1075 0.3576  3924 1.0004
sigma2[8]  2.2871 2.1924 0.6063 1.2246 3.4539  5228 1.0015
sigma2[9]  0.1585 0.1486 0.0529 0.0749 0.2627  2537 1.0006
sigma2[10] 0.1496 0.1423 0.0473 0.0697 0.2412  3462 1.0005
sigma2[11] 0.1951 0.1853 0.0571 0.1005 0.3106  4350 0.9997
sigma2[12] 1.3807 1.3253 0.3564 0.7304 2.0743  6374 1.0001
sigma2[13] 0.2255 0.2117 0.0781 0.1070 0.3809  2800 1.0002
sigma2[14] 2.9402 2.8238 0.7725 1.6593 4.4969  5357 1.0013
sigma2[15] 0.1331 0.1267 0.0391 0.0711 0.2153  4141 0.9995
sigma2[16] 0.1102 0.1049 0.0325 0.0555 0.1744  4263 1.0013
sigma2[17] 0.1045 0.0999 0.0301 0.0546 0.1608  4080 1.0000
sigma2[18] 2.4130 2.2972 0.6643 1.3143 3.7238  4668 1.0005
sigma2[19] 0.1042 0.0987 0.0305 0.0546 0.1647  4405 1.0005
sigma2[20] 1.1223 1.0727 0.3061 0.6228 1.7134  5664 1.0015
sigma2[21] 0.1057 0.1012 0.0295 0.0596 0.1698  4788 1.0004

---

 inner model regression coefficients (beta):

 F1 
      mean     50%     sd   HPD.l   HPD.u n_eff  Rhat
F3  0.8727  0.8567 0.2720  0.3744  1.4327   763 1.004
F4 -0.7390 -0.7340 0.2677 -1.2848 -0.2276   930 1.004

 F2 
      mean     50%     sd   HPD.l   HPD.u n_eff  Rhat
F4 -1.0935 -1.0764 0.2867 -1.6376 -0.5264   848 1.003
F5  0.7629  0.7514 0.2510  0.2962  1.2730   699 1.004

---

 exogenous regression coefficients (gamma0, gamma, tau2): 

 Y1 
             mean     50%     sd   HPD.l   HPD.u n_eff   Rhat
intercept  1.5024  1.5020 0.1401  1.2286  1.7820  5869 1.0004
F1         0.6172  0.6076 0.1417  0.3586  0.9127   805 1.0029
F2        -1.0714 -1.0542 0.1789 -1.4198 -0.7312   493 1.0059
tau2[1]    0.5109  0.4863 0.1527  0.2531  0.8064  4351 0.9999



Head Rhat:
alpha[13,4] alpha[16,4]  alpha[1,1]  alpha[3,1] lambda[1,4] lambda[1,6] 
      1.012       1.012       1.012       1.012       1.011       1.011 

Tail Rhat:
 sigma2[11]  alpha[9,1]  sigma2[15]  alpha[1,3] alpha[19,1] lambda[5,8] 
     0.9997      0.9997      0.9995      0.9995      0.9994      0.9994 

median PTVE:  91.06 
R2: 27.28% 

---
</code></pre>
<p>The effective sample size <code>n_eff</code> gives an estimate of the independent draws from the posterior distribution, and <code>Rhat</code> referred to as the potential scale reduction statistic, is one of the useful ways to monitor whether a chain has converged to the equilibrium distribution. This statistic measures the ratio between the average variation of the samples within each chain and the variation of the combined samples in the chains; if the chains have not converged to a common region, this statistic will be greater than one. Along with the estimates and posterior descriptives, the <code>summary</code> also provides quantities for the diagnosis of the quality of fit of the factorial model: the percentage of the total variability (of variables in X) explained by factors (<code>PVTE</code>) and the <span class="math inline">\(R^2\)</span> statistics adapted for factor analysis (<code>R2</code>).</p>
<p>A crucial difference in obtaining the same statistics printed by the <code><a href="https://rdrr.io/r/base/summary.html">bsem::summary</a></code> function is the use of the <code>signals</code>. The signal specification, (-1 or 1) for each of the factor loadings, forces the initial values of each chain to have the same direction, and, naturally, these chains converge to nearby regions. Otherwise, the loadings signals between chains are often opposite as a consequence of random initialization. To circumvent this issue, the package automatically transforms posterior chains using simple <code>for</code> loops and <code>if</code> statements to recalculate the descriptives using <code><a href="https://mc-stan.org/rstan/reference/monitor.html">rstan::monitor</a></code>.</p>
<p>This page was dedicated to illustrating the commands and outcomes of the proposed package. The closing remarks section highlights the most important aspects of user-defined modeling.</p>
</div>
<div id="remarks" class="section level1">
<h1 class="hasAnchor">
<a href="#remarks" class="anchor"></a>Remarks</h1>
<p>The content of this vignette introduces the <code>bsem</code> package. The current version is ready for the main statistical study in the field of latent variable analysis.</p>
<p>The results obtained with this package vary according to the initial values set for sampling with <code>NUTS</code>. In this sense, we provided user-defined initial values for reproducibility. Also, the number of chains, iterations, and burn-in usually can have a great influence on the analysis. Moreover, <code>NUTS</code> includes tuning parameters that can control the sampler’s behavior, see <a href="https://mc-stan.org/users/documentation/">documentation</a>. From our experience, using just one chain with more iterations can be helpful and convenient depending on the number of parameters adopted in the model specification. Also, highlight the fact that the implemented routines do not support nonlinear or multilevel regression models for paths or exogenous variables.</p>
<p>This document is part of the content submitted to <a href="https://cran.r-project.org/">CRAN</a>. The package is also in public use and is available at the GitHub development platform, the link is <a href="https://github.com/rvpanaro/bsem" class="uri">https://github.com/rvpanaro/bsem</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Renato Panaro, Vinícius Mayrink, Marcelo Costa.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '',
    indexName: 'bsem',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
